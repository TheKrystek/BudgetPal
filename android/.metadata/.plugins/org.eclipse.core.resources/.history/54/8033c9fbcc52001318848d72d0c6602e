package json;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.URL;
import java.net.URLConnection;

import com.google.gson.Gson;

public class WebService {
	GetStatus status;
	URLConnection connection;
	String json;
	String wsPath = "http://mybudgetpal.com/ws/";
	
	private String getJsonFromUrl(String url) throws IOException
	{
		try {
			connection = new URL(wsPath + url).openConnection();
		} catch (Exception e) {
			e.printStackTrace();
		}
		BufferedReader in = new BufferedReader(new InputStreamReader(
                connection.getInputStream()));
		String json = "";
		String line;
		while ((line = in.readLine()) != null) {
			json += line.trim();
		}
		in.close();
		this.json = json;
		return json;
	}
	
	
	public Budgets GetBudgets() throws IOException
	{
		String url = "server2.php?a=getdbudgets";
		this.getJsonFromUrl(url);
		this.status = new GetStatus(json); 
		if (this.status.isSet()){
			return null;
		}
		else
		{
			return new Gson().fromJson(json, Budgets.class);
		}
	}
	
	
	// Zalogowuje, zwraca false w przypadku błędu, albo true jak sie uda
	public bool Login() throws IOException
	{http://mybudgetpal.com/ws/server.php?a=login&user=test&password=ed5465b9220df9ce176d0bf30d6a317729bd9d37e4ae1cc015cb24c99af1df49&pp
		String url = "server.php?a=login";
		this.getJsonFromUrl(url);
		this.status = new GetStatus(json); 
		if (this.status.isSet()){
			System.out.println(this.status);
			return null;
		}
		else
		{
			return new Gson().fromJson(json, Budgets.class);
		}
	}


}
